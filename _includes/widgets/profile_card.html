<!-- 合并优化版：放在你的页面适当位置（如 profile 卡片处） -->
<!-- 需要：Bootstrap 4.5+ 与 Font Awesome 5（下方已附CDN），以及 Jekyll 的 site.data.profile 数据 -->

<!-- Font Awesome（若全站已引入可移除） -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

<style>
  /* 徽标与小工具样式 */
  .inline-badge { height: 22px; vertical-align: -4px; margin-right: 6px; }
  .no-underline { text-decoration: none !important; }
  .no-break { white-space: nowrap; }
  .enlarge-icon { transition: transform .15s ease; display: inline-flex; align-items: center; }
  .enlarge-icon:hover, .enlarge-icon:focus { transform: translateY(-1px) scale(1.05); }
  .icon-row { display: flex; flex-wrap: wrap; align-items: center; gap: .35rem 1rem; }
  .icon-row a i { font-size: 20px; line-height: 1; }
  /* 小屏时让正文左右更透气（可根据站点整体风格微调） */
  @media (max-width: 767.98px) {
    .card-body { padding-left: 30px !important; padding-right: 30px !important; }
  }
</style>

<div class="row">
  <div class="col">
    <div class="card border-0 shadow-sm bg-white">
      <div class="card-body p-5">
        <div class="row">
          <div class="col">

            {% if site.data.profile.portrait_url %}
            <!-- md+ 屏幕：右侧大头像浮动 -->
            <div class="figure float-right ml-4 mb-4 d-none d-md-block">
              <img
                src="{{ site.data.profile.portrait_url | relative_url }}"
                class="figure-img img-fluid img-thumbnail"
                style="height:200px; width:200px; object-fit:cover;"
                data-toggle="tooltip"
                data-placement="top"
                title="{{ site.data.profile.portrait_caption }}"
                alt="{{ site.data.profile.portrait_alt | default: 'Portrait' }}"
                loading="lazy" decoding="async">
            </div>
            {% endif %}

            <!-- 标题与小屏头像（右上角） -->
            <div class="d-flex align-items-start">
              <div class="h1 font-weight-normal mb-0">
                {{ site.data.profile.primary_name }}
                <small>{{ site.data.profile.secondary_name }}</small>
              </div>
              {% if site.data.profile.portrait_url %}
              <div class="ml-auto d-md-none">
                <a target="_blank" href="{{ site.data.profile.portrait_url | relative_url }}" rel="noopener" aria-label="Open portrait">
                  <img src="{{ site.data.profile.portrait_url | relative_url }}" class="rounded-circle" style="height:48px; width:48px; object-fit:cover;" alt="Portrait">
                </a>
              </div>
              {% endif %}
            </div>

            <!-- 职位行 -->
            <div class="text-profile-position mt-2">
              {% for position in site.data.profile.positions %}
                {% if position.logo -%}
                  <img src="{{ position.logo | relative_url }}" alt="{{ position.logo_alt | default: 'Logo' }}" class="inline-badge" loading="lazy" decoding="async"/>
                {%- endif %}
                {{ position.name }}<br/>
              {% endfor %}
            </div>

            <!-- 简述 -->
            <div class="text-profile-bio mt-3" {% if site.data.profile.short_bio_text_justify %}style="text-align:justify;"{% endif %}>
              {{ site.data.profile.short_bio }}
            </div>

            <!-- CV -->
            {% if site.data.profile.cv_link %}
            <div class="mt-2">
              <a class="no-underline enlarge-icon" target="_blank" rel="noopener" href="{{ site.data.profile.cv_link | relative_url }}">
                <i class="fas fa-file-alt mr-1"></i> Curriculum Vitae
              </a>
            </div>
            {% endif %}

          </div>
        </div>

        <hr />

        <!-- 图标/外链行 -->
        <div class="row">
          <div class="col">
            <div class="icon-row">

              <!-- Email -->
              {% if site.data.profile.email %}
              <a class="no-underline enlarge-icon"
                 href="mailto:{{ site.data.profile.email | encode_email }}"
                 aria-label="Email">
                <i class="fas fa-at"></i>
                <span class="email-text ml-1">{{ site.data.profile.email | replace: "@", "(at)" }}</span>
              </a>
              {% endif %}

              <!-- Google Scholar（用毕业帽代替官方图标） -->
              {% if site.data.profile.gscholar %}
                {%- if site.data.profile.gscholar contains 'scholar.google' -%}
                  {%- assign gscholar_url = site.data.profile.gscholar -%}
                {%- else -%}
                  {%- assign gscholar_url = 'https://scholar.google.com/citations?user=' | append: site.data.profile.gscholar -%}
                {%- endif -%}
              <a class="no-underline enlarge-icon"
                 target="_blank" rel="noopener"
                 href="{{ gscholar_url }}" aria-label="Google Scholar">
                <i class="fas fa-graduation-cap"></i>
                <span class="ml-1">Google Scholar</span>
              </a>
              {% endif %}

              <!-- GitHub -->
              {% if site.data.profile.github %}
              <a class="no-underline enlarge-icon"
                 target="_blank" rel="noopener"
                 href="https://github.com/{{ site.data.profile.github }}" aria-label="GitHub">
                <i class="fab fa-github"></i><span class="ml-1">GitHub</span>
              </a>
              {% endif %}

              <!-- WeChat（弹窗二维码） -->
              {% if site.data.profile.wechat_qrcode %}
              <a class="no-underline enlarge-icon"
                 data-toggle="modal" data-target="#modal-wechat"
                 href="javascript:void(0)" aria-label="WeChat">
                <i class="fab fa-weixin"></i><span class="ml-1">WeChat</span>
              </a>
              {% endif %}

              <!-- Twitter/X（这里按 Twitter 传统域名；若你用 X handle 一样可用） -->
              {% if site.data.profile.twitter %}
              <a class="no-underline enlarge-icon"
                 target="_blank" rel="noopener"
                 href="https://twitter.com/{{ site.data.profile.twitter }}" aria-label="Twitter">
                <i class="fab fa-twitter"></i><span class="ml-1">Twitter</span>
              </a>
              {% endif %}

              <!-- LinkedIn -->
              {% if site.data.profile.linkedin %}
              <a class="no-underline enlarge-icon"
                 target="_blank" rel="me noopener"
                 href="https://www.linkedin.com/in/{{ site.data.profile.linkedin }}" aria-label="LinkedIn">
                <i class="fab fa-linkedin"></i><span class="ml-1">LinkedIn</span>
              </a>
              {% endif %}

              <!-- ORCID -->
              {% if site.data.profile.orcid %}
              <a class="no-underline enlarge-icon"
                 target="_blank" rel="me noopener"
                 href="https://orcid.org/{{ site.data.profile.orcid }}" aria-label="ORCID">
                <i class="fab fa-orcid"></i><span class="ml-1">ORCID</span>
              </a>
              {% endif %}

              <!-- Deadline（你站点上的 ddl 页面）；若想隐藏，把 data 里 deadline 留空即可 -->
              {% if site.data.profile.deadline %}
              <a class="no-underline enlarge-icon"
                 target="_blank" rel="noopener"
                 href="https://luna-xue.github.io/{{ site.data.profile.deadline }}" aria-label="Deadline">
                <i class="fas fa-hourglass-half"></i><span class="ml-1">Deadline</span>
              </a>
              {% endif %}

            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>

{% if site.data.profile.wechat_qrcode %}
<!-- WeChat Modal -->
<div class="modal fade" id="modal-wechat" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-sm" role="dialog" aria-label="WeChat QR">
    <div class="modal-content">
      <div class="modal-body p-0">
        <img src="{{ site.data.profile.wechat_qrcode | relative_url }}" class="img-fluid" alt="WeChat QR">
      </div>
      {% if site.data.profile.wechat_prompt %}
      <div class="modal-body p-1">
        {{ site.data.profile.wechat_prompt }}
      </div>
      {% endif %}
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-dismiss="modal" aria-label="Close">Close</button>
      </div>
    </div>
  </div>
</div>
{% endif %}

<!-- 若页面未初始化 tooltip，这里补上（Bootstrap 4） -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    if (typeof $ !== 'undefined' && typeof $.fn.tooltip === 'function') {
      $('[data-toggle="tooltip"]').tooltip();
    }
  });
</script>
